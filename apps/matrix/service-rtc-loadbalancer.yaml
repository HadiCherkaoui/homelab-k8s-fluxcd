apiVersion: v1
kind: Service
metadata:
  name: matrix-rtc-loadbalancer
  namespace: matrix
  annotations:
    # These annotations might vary depending on your LoadBalancer provider
    # Adjust as needed for your infrastructure
    metallb.universe.tf/allow-shared-ip: matrix-rtc
spec:
  type: LoadBalancer
  selector:
    app.kubernetes.io/name: matrix-rtc
    app.kubernetes.io/instance: matrix
    app.kubernetes.io/component: sfu
  ports:
    # TCP port for WebRTC connections
    - name: rtc-tcp
      port: 7881
      targetPort: 7881
      protocol: TCP
    # UDP port for Muxed WebRTC connections
    - name: rtc-udp
      port: 7882
      targetPort: 7882
      protocol: UDP
    # LiveKit RTC port range for media (adjust based on your needs)
    - name: rtc-range-start
      port: 50000
      targetPort: 50000
      protocol: UDP
    - name: rtc-range-end
      port: 60000
      targetPort: 60000
      protocol: UDP
  # Preserve client source IP for better WebRTC connectivity
  externalTrafficPolicy: Local
